<!doctype html><html lang=es-es dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="PhotoMosaic # This program utilizes the power of shaders to create captivating photomosaic effects. By analyzing the luminance of each pixel in an original image, the program intelligently selects smaller images from a palette to replace the pixels, resulting in a visually stunning composition of smaller images that form the larger picture.
Each tile is replaced with a carefully chosen image from a collection of smaller images, creating a mosaic-like representation of the original."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="PhotoMosaic # This program utilizes the power of shaders to create captivating photomosaic effects. By analyzing the luminance of each pixel in an original image, the program intelligently selects smaller images from a palette to replace the pixels, resulting in a visually stunning composition of smaller images that form the larger picture.
Each tile is replaced with a carefully chosen image from a collection of smaller images, creating a mosaic-like representation of the original."><meta property="og:type" content="article"><meta property="og:url" content="https://visualcrackers.github.io/showcase/docs/VisualComputing/Shaders/Code-Results/Mosaic/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-06-19T20:09:33-05:00"><title>Mosaic | Visual Crackers ðŸ’¥</title><link rel=manifest href=/showcase/manifest.json><link rel=icon href=/showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/showcase/book.min.d22a60abc40100847f86f22dd3b86c75dccdfdb323f5314b4227cb88db47b288.css integrity="sha256-0ipgq8QBAIR/hvIt07hsddzN/bMj9TFLQifLiNtHsog=" crossorigin=anonymous><script defer src=/showcase/flexsearch.min.js></script>
<script defer src=/showcase/en.search.min.3a8d658c77eb93c7f12a2b8af49a700131e474f288eefb605d9fa61576dbe5a7.js integrity="sha256-Oo1ljHfrk8fxKiuK9JpwATHkdPKI7vtgXZ+mFXbb5ac=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/showcase/><span>Visual Crackers ðŸ’¥</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Visual Computing</span><ul><li><input type=checkbox id=section-4a86fae448a0f2e6d110fe23b7c4ce25 class=toggle>
<label for=section-4a86fae448a0f2e6d110fe23b7c4ce25 class="flex justify-between"><a role=button>Visual Ilusions</a></label><ul><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Intro-background/>Intro & Background</a></li><li><input type=checkbox id=section-0cee58da2e2f7ba7406b81f716a40f1b class=toggle>
<label for=section-0cee58da2e2f7ba7406b81f716a40f1b class="flex justify-between"><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/>Code & Results</a></label><ul><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/Palette/>Palette</a></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/ColorTracker/>Color Tracker</a></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/ReColoring/>Re Coloring</a></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/Histogram/>Histogram</a></li></ul></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Conclusions-Future-work/>Conclusions & Future Work</a></li></ul></li><li><input type=checkbox id=section-0d6c9b58e4921d4dbec9a87d14426653 class=toggle>
<label for=section-0d6c9b58e4921d4dbec9a87d14426653 class="flex justify-between"><a role=button>Transformations</a></label><ul><li><a href=/showcase/docs/VisualComputing/Transformations/Intro-background/>Intro & Background</a></li><li><input type=checkbox id=section-8cec2435bf1386ecadd18a96df947a94 class=toggle>
<label for=section-8cec2435bf1386ecadd18a96df947a94 class="flex justify-between"><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/>Code & Results</a></label><ul><li><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/2D-Solar-System/>2 D Solar System</a></li><li><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/3D-Solar-System/>3 D Solar System</a></li><li><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/Texture-Lighting/>Texture & Lighting</a></li></ul></li><li><a href=/showcase/docs/VisualComputing/Transformations/Conclusions-Future-work/>Conclusions & Future Work</a></li></ul></li><li><input type=checkbox id=section-28214bdf74b91f88b798d6a345130776 class=toggle checked>
<label for=section-28214bdf74b91f88b798d6a345130776 class="flex justify-between"><a role=button>Shaders</a></label><ul><li><a href=/showcase/docs/VisualComputing/Shaders/Intro-background/>Intro & Background</a></li><li><input type=checkbox id=section-2861031ceef2b1efc95889a5715c6ea4 class=toggle checked>
<label for=section-2861031ceef2b1efc95889a5715c6ea4 class="flex justify-between"><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/>Code & Results</a></label><ul><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Color-Blender/>Color Blender</a></li><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Glitch-Board/>Glitch Board</a></li><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Mosaic/ class=active>Mosaic</a></li><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Smart-Mosaic/>Smart Mosaic</a></li></ul></li><li><a href=/showcase/docs/VisualComputing/Shaders/Conclusions-Future-work/>Conclusions & Future Work</a></li></ul></li></ul></li><li><a href=/showcase/docs/About/>About</a></li><li><a href=/showcase/docs/Video/Video/>Video</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Mosaic</strong>
<label for=toc-control><img src=/showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#photomosaic><strong>PhotoMosaic</strong></a><ul><li><a href=#how-does-it-works>How does it works?</a></li><li><a href=#result>Result</a></li><li><a href=#full-code>Full Code</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=photomosaic><strong>PhotoMosaic</strong>
<a class=anchor href=#photomosaic>#</a></h1><p>This program utilizes the power of shaders to create captivating <a href=https://en.wikipedia.org/wiki/Photographic_mosaic>photomosaic</a> effects. By analyzing the luminance of each pixel in an original image, the program intelligently selects smaller images from a palette to replace the pixels, resulting in a visually stunning composition of smaller images that form the larger picture.</p><p>Each tile is replaced with a carefully chosen image from a collection of smaller images, creating a mosaic-like representation of the original.</p><h2 id=how-does-it-works>How does it works?
<a class=anchor href=#how-does-it-works>#</a></h2><p>The fragment shader code performs intricate calculations to determine the closest match between the luminance values of the original image pixels and the images in the palette. It adjusts the texture coordinates and retrieves the corresponding images to seamlessly blend them into the mosaic. The shader also provides the option to visualize the UV coordinates to understand better the contribution from each tile.</p><p>Inside the <em>main()</em> function of the <em>fragment shader</em>, it calculates the luminance (brightness) of the current texel from the original image using the luma() function implemented with <a href=https://stackoverflow.com/questions/596216/formula-to-determine-perceived-brightness-of-rgb-color>Component average</a>. Then, the shader proceeds to find the closest match from the palette of smaller images iterating over each image in the palette and comparing the luminance values.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// alpha channel (texel.a) is just discarded
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0.299</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.587</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.114</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>getCloser</span>(<span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span>, <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>coord</span>){
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>distancia</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>999999.9</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lumaOriginal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>texel</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lumaTemp</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>maxNum</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>n</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>coord</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>i</span>)<span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lumaTemp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>temp</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>lumaOriginal</span><span style=color:#f92672>-</span><span style=color:#a6e22e>lumaTemp</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>distancia</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distancia</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>lumaOriginal</span><span style=color:#f92672>-</span><span style=color:#a6e22e>lumaTemp</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>closest</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Once the closest match is determined, the shader adjusts the texture coordinates to correspond to the position within the selected image in the palette, it is because GLSL does not accept an array of images or sampler2D, and the solution we used was to create a &ldquo;large&rdquo; image where we display all the pictures.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>closest</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>adjustedCoords</span>);
</span></span></code></pre></div><h2 id=result>Result
<a class=anchor href=#result>#</a></h2><p>The bellow sketch shows the implementation of th <strong>photomosaic</strong> with a palette of 30 paintings that are used to paint as a group, one of them. With the slider it is possible to change the number of tiles that are used to paint the selected image. Naturally, with a big number of tiles, the result is better; the maximum number of paintings that are set is 300x300.</p><blockquote class="book-hint info">You can change the selected painting by pressing the &lsquo;r&rsquo; key and get a new random one.</blockquote><iframe id=palette class=sketch srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            <script src=/showcase/sketches/shaders/mosaics/normal.js>
            </script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><blockquote class="book-hint danger">There are some paintings that does not look quite good. It is due to the palette used, probably the <em>luma</em> of them dont cover all the posibilities and the match is not as good as it could be.</blockquote><h2 id=full-code>Full Code
<a class=anchor href=#full-code>#</a></h2><blockquote class="book-hint danger">For the <em>Vertex Shader</em> we are implementing the <strong>Tree.texcoords2</strong> instance from the library <em><strong><a href=https://github.com/VisualComputing/p5.treegl>p5.treegl</a></strong></em> developed by <a href=https://github.com/nakednous>Jean Pierre Charalambos</a> and <a href=https://github.com/dangulos>Daniel Angulo</a></blockquote><p><details><summary>photoMosaic.js</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>selected</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mosaic</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>uv</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>palette</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pics</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>resolution</span>, <span style=color:#a6e22e>quantity</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;normalMosaic.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>texcoords2</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pics</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) <span style=color:#a6e22e>pics</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>`pic</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.png`</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>600</span>, <span style=color:#ae81ff>600</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>textureMode</span>(<span style=color:#a6e22e>NORMAL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>mosaic</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;resolution&#39;</span>, <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createCheckbox</span>(<span style=color:#e6db74>&#39;uv visualization&#39;</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;color&#39;</span>, <span style=color:#e6db74>&#39;magenta&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>changed</span>(() =&gt; <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;uv&#39;</span>, <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>checked</span>()));
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;n&#39;</span>, <span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;resolution&#39;</span>, <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;uv&#39;</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selected</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>pics</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>generatePalette</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generatePalette</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>palette</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>128</span><span style=color:#f92672>*</span>(<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>),<span style=color:#ae81ff>128</span>); <span style=color:#75715e>//Object with images to shader
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>palette</span>.<span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>pics</span>[<span style=color:#a6e22e>i</span>], <span style=color:#ae81ff>128</span><span style=color:#f92672>*</span><span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>128</span>, <span style=color:#ae81ff>128</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;r&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;R&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selected</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>pics</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>generatePalette</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>120</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;original&#39;</span>, <span style=color:#a6e22e>pics</span>[<span style=color:#a6e22e>selected</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;pics&#39;</span>, <span style=color:#a6e22e>palette</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><br></p><details><summary>photoMosaic.frag</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>precision</span> <span style=color:#a6e22e>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// palette is sent by the sketch and comprises the video
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>maxNum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>29</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>sampler2D</span> <span style=color:#a6e22e>original</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>sampler2D</span> <span style=color:#a6e22e>pics</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// target horizontal &amp; vertical resolution
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>resolution</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// uv visualization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>bool</span> <span style=color:#a6e22e>uv</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// texture space normalized interpolated texture coordinates
</span></span></span><span style=display:flex><span><span style=color:#75715e>// should have same name and type as in vertex shader
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>varying</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>texcoords2</span>; <span style=color:#75715e>// (defined in [0..1] âˆˆ R)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// alpha channel (texel.a) is just discarded
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0.299</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.587</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.114</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>getCloser</span>(<span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span>, <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>coord</span>){
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>distancia</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>999999.9</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lumaOriginal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>texel</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lumaTemp</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>maxNum</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>n</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>coord</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>i</span>)<span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lumaTemp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>temp</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>lumaOriginal</span><span style=color:#f92672>-</span><span style=color:#a6e22e>lumaTemp</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>distancia</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distancia</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>lumaOriginal</span><span style=color:#f92672>-</span><span style=color:#a6e22e>lumaTemp</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>closest</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>rand</span>(<span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>co</span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fract</span>(<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>co</span>, <span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>12.9898</span>, <span style=color:#ae81ff>78.233</span>))) <span style=color:#f92672>*</span> <span style=color:#ae81ff>43758.5453</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>resolution</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>stepCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>symbolCoord</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>stepCoord</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>original</span>, <span style=color:#a6e22e>stepCoord</span><span style=color:#f92672>/</span><span style=color:#a6e22e>vec2</span>(<span style=color:#a6e22e>resolution</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCloser</span>(<span style=color:#a6e22e>texel</span>, <span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>1.0</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>closest</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>adjustedCoords</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gl_FragColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>uv</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>adjustedCoords</span>.<span style=color:#a6e22e>st</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><style>.sketch{width:630px;height:630px;display:flex}</style></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcrackers/showcase/commit/d221056326c70c123781ac2a14111f34d8c04c96 title='Last modified by Ivan Yared Lombana Lozano | June 20, 2023' target=_blank rel=noopener><img src=/showcase/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 20, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#photomosaic><strong>PhotoMosaic</strong></a><ul><li><a href=#how-does-it-works>How does it works?</a></li><li><a href=#result>Result</a></li><li><a href=#full-code>Full Code</a></li></ul></li></ul></nav></div></aside></main></body></html>