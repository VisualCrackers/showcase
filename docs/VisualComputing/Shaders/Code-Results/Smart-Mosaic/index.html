<!doctype html><html lang=es-es dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Smart PhotoMosaic # This program is a super powered version of the previous PhotoMosaic. It will let you appreciate the best things of each painting and with that, give a better visual result about the expected image.
The p5.js code provides the interactive interface and handles the image processing pipeline, but behind the scenes, the GLSL fragment shader does the heavy lifting.
How does it works? # The fragment shader takes the original image and the palette of smaller images as inputs."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Smart PhotoMosaic # This program is a super powered version of the previous PhotoMosaic. It will let you appreciate the best things of each painting and with that, give a better visual result about the expected image.
The p5.js code provides the interactive interface and handles the image processing pipeline, but behind the scenes, the GLSL fragment shader does the heavy lifting.
How does it works? # The fragment shader takes the original image and the palette of smaller images as inputs."><meta property="og:type" content="article"><meta property="og:url" content="https://visualcrackers.github.io/showcase/docs/VisualComputing/Shaders/Code-Results/Smart-Mosaic/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-06-19T21:17:41-05:00"><title>Smart Mosaic | Visual Crackers ðŸ’¥</title><link rel=manifest href=/showcase/manifest.json><link rel=icon href=/showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/showcase/book.min.d22a60abc40100847f86f22dd3b86c75dccdfdb323f5314b4227cb88db47b288.css integrity="sha256-0ipgq8QBAIR/hvIt07hsddzN/bMj9TFLQifLiNtHsog=" crossorigin=anonymous><script defer src=/showcase/flexsearch.min.js></script>
<script defer src=/showcase/en.search.min.3a8d658c77eb93c7f12a2b8af49a700131e474f288eefb605d9fa61576dbe5a7.js integrity="sha256-Oo1ljHfrk8fxKiuK9JpwATHkdPKI7vtgXZ+mFXbb5ac=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/showcase/><span>Visual Crackers ðŸ’¥</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Visual Computing</span><ul><li><input type=checkbox id=section-4a86fae448a0f2e6d110fe23b7c4ce25 class=toggle>
<label for=section-4a86fae448a0f2e6d110fe23b7c4ce25 class="flex justify-between"><a role=button>Visual Ilusions</a></label><ul><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Intro-background/>Intro & Background</a></li><li><input type=checkbox id=section-0cee58da2e2f7ba7406b81f716a40f1b class=toggle>
<label for=section-0cee58da2e2f7ba7406b81f716a40f1b class="flex justify-between"><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/>Code & Results</a></label><ul><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/Palette/>Palette</a></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/ColorTracker/>Color Tracker</a></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/ReColoring/>Re Coloring</a></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Code-Results/Histogram/>Histogram</a></li></ul></li><li><a href=/showcase/docs/VisualComputing/Visual-Ilusions/Conclusions-Future-work/>Conclusions & Future Work</a></li></ul></li><li><input type=checkbox id=section-0d6c9b58e4921d4dbec9a87d14426653 class=toggle>
<label for=section-0d6c9b58e4921d4dbec9a87d14426653 class="flex justify-between"><a role=button>Transformations</a></label><ul><li><a href=/showcase/docs/VisualComputing/Transformations/Intro-background/>Intro & Background</a></li><li><input type=checkbox id=section-8cec2435bf1386ecadd18a96df947a94 class=toggle>
<label for=section-8cec2435bf1386ecadd18a96df947a94 class="flex justify-between"><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/>Code & Results</a></label><ul><li><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/2D-Solar-System/>2 D Solar System</a></li><li><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/3D-Solar-System/>3 D Solar System</a></li><li><a href=/showcase/docs/VisualComputing/Transformations/Code-Results/Texture-Lighting/>Texture & Lighting</a></li></ul></li><li><a href=/showcase/docs/VisualComputing/Transformations/Conclusions-Future-work/>Conclusions & Future Work</a></li></ul></li><li><input type=checkbox id=section-28214bdf74b91f88b798d6a345130776 class=toggle checked>
<label for=section-28214bdf74b91f88b798d6a345130776 class="flex justify-between"><a role=button>Shaders</a></label><ul><li><a href=/showcase/docs/VisualComputing/Shaders/Intro-background/>Intro & Background</a></li><li><input type=checkbox id=section-2861031ceef2b1efc95889a5715c6ea4 class=toggle checked>
<label for=section-2861031ceef2b1efc95889a5715c6ea4 class="flex justify-between"><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/>Code & Results</a></label><ul><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Color-Blender/>Color Blender</a></li><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Glitch-Board/>Glitch Board</a></li><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Mosaic/>Mosaic</a></li><li><a href=/showcase/docs/VisualComputing/Shaders/Code-Results/Smart-Mosaic/ class=active>Smart Mosaic</a></li></ul></li><li><a href=/showcase/docs/VisualComputing/Shaders/Conclusions-Future-work/>Conclusions & Future Work</a></li></ul></li></ul></li><li><a href=/showcase/docs/About/>About</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Smart Mosaic</strong>
<label for=toc-control><img src=/showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#smart-photomosaic><strong>Smart PhotoMosaic</strong></a><ul><li><a href=#how-does-it-works>How does it works?</a></li><li><a href=#result>Result</a></li><li><a href=#full-code>Full Code</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=smart-photomosaic><strong>Smart PhotoMosaic</strong>
<a class=anchor href=#smart-photomosaic>#</a></h1><p>This program is a <strong>super powered</strong> version of the previous PhotoMosaic. It will let you appreciate the best things of each painting and with that, give a better visual result about the expected image.</p><p>The p5.js code provides the interactive interface and handles the image processing pipeline, but behind the scenes, the GLSL fragment shader does the heavy lifting.</p><h2 id=how-does-it-works>How does it works?
<a class=anchor href=#how-does-it-works>#</a></h2><p>The fragment shader takes the original image and the palette of smaller images as inputs. For <strong>every single pixel</strong>, the shader calculates its <em>luma</em> value, that represent its brightness. And then, looks into the pixel&rsquo;s images palette the one that fits better with the light value of the pixel in the same position. This represent an improvement in the performance of the progam, and a better approach to the desired objetive.</p><p>Basically, this code takes the best of each image <strong>excluding the selected to be plotted</strong> (otherwise it will be the best fit), and create a new painting with a lot of parts from others. For instance, it could take the hole background from one pic, the face of a person from other one, and the rest of the body of a third one.</p><p>It allows to create a new paiting that also have an unique art style, and recreates images in a very advanced way. In fact, some artificial intelligence apply this <a href="https://www.tensorflow.org/tutorials/generative/style_transfer#:~:text=Neural%20style%20transfer%20is%20an,of%20the%20style%20reference%20image.">technique</a> to create the images that provide us. <a href=https://towardsdatascience.com/when-ai-meets-art-neural-style-transfer-with-magenta-js-ceb50e702730>More info.</a></p><p>The difference with the previous one is that it takes each pixel, and not the image at all.</p><p>On the code, the differences are minimum, it just represent a change of the coords that are being used. There is a fragment of the coordinates that are used in the shader.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>original</span>, <span style=color:#a6e22e>texcoords2</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>resolution</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>stepCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>symbolCoord</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>stepCoord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCloser</span>(<span style=color:#a6e22e>texel</span>, <span style=color:#a6e22e>adjustedCoords</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>closest</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>adjustedCoords</span>);
</span></span></code></pre></div><h2 id=result>Result
<a class=anchor href=#result>#</a></h2><blockquote class="book-hint info"><p>Up to the left are located two sliders, the first one control the grid size, changuing the size of the tiles that are used. The second slider, set the number of images that will contain the palette, bewteen 1 and 10.</p><p>There is also provided the UV coords visualization checkbox.</p></blockquote><blockquote class="book-hint info"><p>You can see how the quality of the image change when more images are added to the palette. But this program have awesome result with even just 2 images.</p><p>We recommend the result for <em>&ldquo;The Starry Night - Vincent van Gogh&rdquo;</em>.</p></blockquote><blockquote class="book-hint warning">You can change the selected painting by pressing the &lsquo;r&rsquo; key and get a new random one.</blockquote><iframe id=palette class=sketch srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            <script src=/showcase/sketches/shaders/mosaics/smart.js>
            </script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><blockquote class="book-hint danger">This sketch could crash if there is selected a large amount of tiles and the user starts to change rapidly the number of images used on the palette. It is because depending the number of images, the buffer palette change, and it should be reset and made again; this takes a high computational cost and can do the webpage to stop. Please dont try it :(</blockquote><h2 id=full-code>Full Code
<a class=anchor href=#full-code>#</a></h2><blockquote class="book-hint danger">For the <em>Vertex Shader</em> we are implementing the <strong>Tree.texcoords2</strong> instance from the library <em><strong><a href=https://github.com/VisualComputing/p5.treegl>p5.treegl</a></strong></em> developed by <a href=https://github.com/nakednous>Jean Pierre Charalambos</a> and <a href=https://github.com/dangulos>Daniel Angulo</a></blockquote><p><details><summary>smartMosaic.js</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>selected</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mosaic</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>uv</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>palette</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pics</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>resolution</span>, <span style=color:#a6e22e>quantity</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;smartMosaic.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>texcoords2</span> });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pics</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>10</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) <span style=color:#a6e22e>pics</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>`pic</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.png`</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>600</span>, <span style=color:#ae81ff>600</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>textureMode</span>(<span style=color:#a6e22e>NORMAL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>mosaic</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>15</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;resolution&#39;</span>, <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>quantity</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>quantity</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>35</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>quantity</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>quantity</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>generatePalette</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;n&#39;</span>, <span style=color:#a6e22e>quantity</span>.<span style=color:#a6e22e>value</span>()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createCheckbox</span>(<span style=color:#e6db74>&#39;uv visualization&#39;</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;color&#39;</span>, <span style=color:#e6db74>&#39;magenta&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>changed</span>(() =&gt; <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;uv&#39;</span>, <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>checked</span>()));
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uv</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>60</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;n&#39;</span>, <span style=color:#a6e22e>quantity</span>.<span style=color:#a6e22e>value</span>()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;resolution&#39;</span>, <span style=color:#a6e22e>resolution</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;uv&#39;</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selected</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>pics</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>generatePalette</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generatePalette</span>(){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>quantity</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>palette</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>720</span><span style=color:#f92672>*</span>(<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>),<span style=color:#ae81ff>720</span>); <span style=color:#75715e>//Object with images to shader
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>!=</span><span style=color:#a6e22e>selected</span>){ <span style=color:#75715e>//Avoid incluying the selected image
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>palette</span>.<span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>pics</span>[<span style=color:#a6e22e>i</span>], <span style=color:#ae81ff>720</span><span style=color:#f92672>*</span><span style=color:#a6e22e>offset</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>720</span>, <span style=color:#ae81ff>720</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>offset</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;r&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;R&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selected</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>pics</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>generatePalette</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>120</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;original&#39;</span>, <span style=color:#a6e22e>pics</span>[<span style=color:#a6e22e>selected</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mosaic</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;pics&#39;</span>, <span style=color:#a6e22e>palette</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>img</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Iterate over each pixel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Get the pixel color
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pixelColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Extract the red, green, and blue channels
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>red</span>(<span style=color:#a6e22e>pixelColor</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>green</span>(<span style=color:#a6e22e>pixelColor</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>blue</span>(<span style=color:#a6e22e>pixelColor</span>);
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Calculate the luma using the formula: Y = 0.299R + 0.587G + 0.114B
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>luma</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.299</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.587</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.114</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Accumulate the luma value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>sum</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>luma</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Calculate the average luma by dividing the sum by the total number of pixels
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>averageLuma</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>/</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>averageLuma</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><br></p><details><summary>smartMosaic.frag</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>precision</span> <span style=color:#a6e22e>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>maxNum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// target image to paint
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>sampler2D</span> <span style=color:#a6e22e>original</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// pics is a the palette sent by the sketch
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>sampler2D</span> <span style=color:#a6e22e>pics</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// target horizontal &amp; vertical resolution
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>resolution</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// uv visualization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>bool</span> <span style=color:#a6e22e>uv</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// texture space normalized interpolated texture coordinates
</span></span></span><span style=display:flex><span><span style=color:#75715e>// should have same name and type as in vertex shader
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>varying</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>texcoords2</span>; <span style=color:#75715e>// (defined in [0..1] âˆˆ R)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// alpha channel (texel.a) is just discarded
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0.299</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.587</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.114</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>getCloser</span>(<span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span>, <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>coord</span>){
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Function to find the closer luma image to the original
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>distancia</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>999999.9</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lumaOriginal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>texel</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lumaTemp</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>maxNum</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>n</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>coord</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>i</span>)<span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lumaTemp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>temp</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>lumaOriginal</span><span style=color:#f92672>-</span><span style=color:#a6e22e>lumaTemp</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>distancia</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distancia</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>lumaOriginal</span><span style=color:#f92672>-</span><span style=color:#a6e22e>lumaTemp</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>closest</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>texel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>original</span>, <span style=color:#a6e22e>texcoords2</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>resolution</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>stepCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>symbolCoord</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>stepCoord</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>symbolCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>closest</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCloser</span>(<span style=color:#a6e22e>texel</span>, <span style=color:#a6e22e>adjustedCoords</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>adjustedCoords</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>closest</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vec2</span>(<span style=color:#ae81ff>0.5</span><span style=color:#f92672>/</span>(<span style=color:#66d9ef>float</span>(<span style=color:#a6e22e>n</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>), <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>pics</span>, <span style=color:#a6e22e>adjustedCoords</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gl_FragColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>uv</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>adjustedCoords</span>.<span style=color:#a6e22e>st</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><style>.sketch{width:630px;height:630px;display:flex}</style></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcrackers/showcase/commit/a4bcb1ea3723e1a8a1eee85ceb78169087bf6937 title='Last modified by Ivan Yared Lombana Lozano | June 20, 2023' target=_blank rel=noopener><img src=/showcase/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 20, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#smart-photomosaic><strong>Smart PhotoMosaic</strong></a><ul><li><a href=#how-does-it-works>How does it works?</a></li><li><a href=#result>Result</a></li><li><a href=#full-code>Full Code</a></li></ul></li></ul></nav></div></aside></main></body></html>